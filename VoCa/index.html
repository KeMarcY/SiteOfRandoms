<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angol-Magyar Szótár</title>
    <!-- Library for the PNG export feature -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #808080; /* Grey background */
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .controls {
            background-color: #f0f0f0;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }
        .controls input, .controls select, .controls button {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        .controls input {
            flex-grow: 1;
            min-width: 200px;
        }
        .controls button {
            background-color: #5cb85c;
            color: white;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s;
        }
        .controls button:hover {
            background-color: #4cae4c;
        }
        
        #vocabulary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two equal columns */
            gap: 10px;
            background-color: #a9a9a9;
            padding: 20px;
            border-radius: 15px;
        }

        .header-item, .letter-header {
            background-color: #dcdcdc;
            color: #000;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            border-radius: 25px;
            margin-bottom: 10px;
        }

        .term-item {
            background-color: #f5f5f5;
            color: #000;
            padding: 15px;
            border-radius: 12px;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            min-height: 2.5em; 
        }
        
        .letter-header {
            grid-column: 1 / -1; /* Makes the header span both columns */
            background-color: #b0c4de; /* A different color to stand out */
            margin-top: 15px;
            text-align: left;
            padding-left: 20px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="controls">
            <!-- The new dropdown menu for selecting the JSON file -->
            <select id="jsonSelector">
                <option value="words.json">Teljes Szótár</option>
                <option value="topicone.json">(S1) 1. Téma: Munka</option>
                <option value="unit9.json">(A1) Unit 9 [09.29.]</option>
            </select>
            <input type="text" id="searchInput" placeholder="Keress egy szóra...">
            <button id="exportBtn">Exportálás PNG-be</button>
        </div>

        <div id="vocabulary-grid">
            <!-- JavaScript will populate this area -->
        </div>
    </div>

    <script>
        // Get references to all interactive elements
        const vocabGrid = document.getElementById('vocabulary-grid');
        const searchInput = document.getElementById('searchInput');
        const exportBtn = document.getElementById('exportBtn');
        const jsonSelector = document.getElementById('jsonSelector');
        
        let fullVocabulary = []; // This will hold the data from the currently loaded JSON file

        // Renders the vocabulary based on the `fullVocabulary` array
        const renderVocabulary = () => {
            const filterTerm = searchInput.value.toLowerCase();
            vocabGrid.innerHTML = ''; // Clear the grid

            // Add main headers
            const enHeader = document.createElement('div');
            enHeader.className = 'header-item';
            enHeader.textContent = 'English';
            vocabGrid.appendChild(enHeader);

            const huHeader = document.createElement('div');
            huHeader.className = 'header-item';
            huHeader.textContent = 'Hungarian';
            vocabGrid.appendChild(huHeader);
            
            // Filter the current vocabulary list
            const filteredVocab = fullVocabulary.filter(item => 
                item.en.toLowerCase().includes(filterTerm) || 
                item.hu.toLowerCase().includes(filterTerm)
            );
            // Sort the filtered list alphabetically by English
            filteredVocab.sort((a, b) => a.en.localeCompare(b.en));

            let currentLetter = '';
            filteredVocab.forEach(item => {
                const firstLetter = item.en.charAt(0).toUpperCase();
                if (firstLetter && firstLetter !== currentLetter) {
                    currentLetter = firstLetter;
                    const letterHeader = document.createElement('div');
                    letterHeader.className = 'letter-header';
                    letterHeader.textContent = currentLetter;
                    vocabGrid.appendChild(letterHeader);
                }
                
                const enItem = document.createElement('div');
                enItem.className = 'term-item';
                enItem.textContent = item.en;
                vocabGrid.appendChild(enItem);

                const huItem = document.createElement('div');
                huItem.className = 'term-item';
                huItem.textContent = item.hu;
                vocabGrid.appendChild(huItem);
            });
        };

        // Fetches and loads a new vocabulary list from a given filename
        const loadVocabulary = (filename) => {
            fetch(filename)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Could not load ${filename}. File not found or error.`);
                    }
                    return response.json();
                })
                .then(data => {
                    fullVocabulary = data; // Update the global vocabulary list
                    renderVocabulary(); // Render the new list
                })
                .catch(error => {
                    console.error('Error fetching vocabulary:', error);
                    vocabGrid.innerHTML = `<div class="header-item" style="grid-column: 1 / -1;">${error.message}</div>`;
                });
        };

        // --- EVENT LISTENERS ---

        // When the page first loads, load the default selected JSON file
        document.addEventListener('DOMContentLoaded', () => {
            loadVocabulary(jsonSelector.value);
        });

        // When the user changes the selection in the dropdown, load the new file
        jsonSelector.addEventListener('change', () => {
            loadVocabulary(jsonSelector.value);
        });

        // When the user types in the search box, re-render the current list
        searchInput.addEventListener('input', renderVocabulary);

        // Handle the PNG export
        exportBtn.addEventListener('click', () => {
            vocabGrid.style.width = '1200px';
            html2canvas(vocabGrid, { scale: 2, backgroundColor: '#a9a9a9' })
                .then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'vocabulary.png';
                    link.href = canvas.toDataURL();
                    link.click();
                    vocabGrid.style.width = ''; 
                });
        });
    </script>
</body>
</html>